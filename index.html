<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <title>Subir imagen</title>
        <script type="text/javascript" src="js/jquery-2.0.0.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script>
            function hacerFoto(){
                navigator.camera.getPicture(onSuccess, onFail, { quality: 50, destinationType: Camera.DestinationType.FILE_URI });
                //navigator.camera.getPicture(onSuccess, onFail, { quality: 50, destinationType: Camera.DestinationType.DATA_URL });
            }
            
            function onSuccess(imageURI) {
                alert("imageUri "+imageURI)
                var image = document.getElementById('fotoLocal');
                image.src = imageURI;
                //var image2 = document.getElementById('fotoLocalII');
                //image2.src = "data:image/jpeg;base64," + imageURI;
                
                var canvas = document.getElementById("micanvas");
                var ctx = canvas.getContext("2d");
                var img = new Image();
                img.src = imageURI;
                //img.src = "img/logo.png";
                ctx.drawImage(img, 0, 0);
                img.onload = function(){
                    ctx.drawImage(img, 0, 0);
                }
            }
            
            function uploadFile(){
                //subir imagen
                //192.168.0.32
                var urlServidor = "http://192.168.0.32:8080/guardar";
                //var urlServidor = "http://192.168.0.106:8080/guardar";
              	var canvas = document.getElementById ("micanvas");
        		alert("mi Pic "+canvas.toDataURL());
        		//alert("mi Pic "+imageURI);
                var body = {};
                body.urlFile = canvas.toDataURL();
                //body.urlFile = imageURI;
                $.ajax({
        		  url: urlServidor,
        		  data: body,
        		  type: "post",
        		  success: function(response) {
        		  		if(response.type){
        					alert("ps creo que se guardo")
        				}else{
        					alert("PTM NO se guardo")
        				}
        		  	}
        		  });
                
                //subirImagen(imageURI)                             
            }
        
            function onFail(message) {
                alert('Failed because: ' + message);
            }

            /*function subirImagen(imageURI){
                alert("subiendo imagen a ver que pedo")
                // Verify server has been entered
                //server = 'http://192.168.1.3:8180/newimage/';
                server = 'http://192.168.0.106:8080';
                if (server) {
                    alert("starting upload");
                    // Specify transfer options
                    var options = new FileUploadOptions();
                    options.fileKey="file";
                    options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
                    options.mimeType="image/jpeg"
                    options.chunkedMode = false;

                    // Transfer picture to server
                    var ft = new FileTransfer();
                    ft.upload(imageURI, server, function(r) {
                        document.getElementById('camera_status').innerHTML = "Upload successful: "+r.bytesSent+" bytes uploaded.";              
                    }, function(error) {
                        document.getElementById('camera_status').innerHTML = "Upload failed: Code = "+error.code;               
                    }, options, true);
                }
            }
            
            function subirImagen(fileURL) {
            
                var options = new FileUploadOptions();
                options.fileKey = "imagen";
                options.fileName = fileURL.substr(fileURL.lastIndexOf('/') + 1);

                var ft = new FileTransfer();
                ft.upload(fileURL, encodeURI("http://jcesar.16mb.com/upload/upload.php"), uploadSuccess, uploadFail, options);
            }

            function uploadSuccess(r) {
                alert("Code = " + r.responseCode+" Response = " + r.response+" Sent = " + r.bytesSent);
                var image = document.getElementById('fotoServidor');
                image.src = r.response;
            }

            function uploadFail(error) {
                alert("An error has occurred: Code = " + error.code+ " upload error source " + error.source+" upload error target " + error.target);
            }*/
                                        
        </script>
    </head>
    <body>
        <div class="app">
            <h1>Apache Cordova</h1>
            <input type="button" onclick="hacerFoto();"  value="Tome una Foto">
            <img id="fotoLocal" src="" width="100px" height="100px">
            <br>
            <canvas height="300px" width="300px" id="micanvas"></canvas>
            <!--img id="fotoLocalII" src="" width="100px" height="100px"-->
            <!--img id="fotoServidor" src="" width="100px" height="100px"-->
            <div id="camera_status"></div>
        </div>
        <!--script type="text/javascript" src="cordova.js"></script-->
    </body>
</html>
